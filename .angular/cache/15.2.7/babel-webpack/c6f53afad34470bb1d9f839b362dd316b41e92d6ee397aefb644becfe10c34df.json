{"ast":null,"code":"import { TicketModel } from '../models/ticket.model';\nimport { SaleModel } from '../models/sale.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/showing.service\";\nimport * as i2 from \"../services/chair.service\";\nimport * as i3 from \"../services/sale.service\";\nimport * as i4 from \"../services/schedule.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nfunction SaleComponent_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 10);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r2.showID);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(item_r2.movieName);\n  }\n}\nfunction SaleComponent_tr_10_td_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"td\")(1, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function SaleComponent_tr_10_td_1_Template_button_click_1_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r6.onClick($event));\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const r_r5 = ctx.$implicit;\n    const c_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate2(\"id\", \"\", r_r5, \"\", c_r3, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"\", r_r5, \"\", c_r3, \"\");\n  }\n}\nfunction SaleComponent_tr_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵtemplate(1, SaleComponent_tr_10_td_1_Template, 3, 4, \"td\", 5);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.rows);\n  }\n}\nexport class SaleComponent {\n  constructor(showingService, chairService, saleService, scheduleService, router) {\n    this.showingService = showingService;\n    this.chairService = chairService;\n    this.saleService = saleService;\n    this.scheduleService = scheduleService;\n    this.router = router;\n    this.rows = [];\n    this.columns = [];\n    this.saleValue = 0;\n    this.chairsSellList = [];\n    this.disableChairs = [];\n    this.allChairsList = [];\n    this.discount = 0;\n  }\n  ngOnInit() {\n    //this.FullColumns();\n    try {\n      this.showingService.getShowings().subscribe(data => {\n        this.showings = data;\n      });\n      this.chairService.getRows().subscribe(data => {\n        this.columns = data;\n      });\n      this.chairService.getNumbers().subscribe(data => {\n        this.rows = data;\n      });\n    } catch (e) {\n      console.log(\"error: \" + e);\n    }\n  }\n  onChange() {\n    console.log(\"ID Selected: \" + this.selectedItem);\n    this.saleValue = 0;\n    let button = document.getElementById(\"sellbtn\");\n    if (button) {\n      button.disabled = false;\n    }\n    this.clearColors();\n    this.chairService.getOccupiedChairsByShow(this.selectedItem).subscribe(data => {\n      this.disableChairs = data;\n      if (this.disableChairs != null) {\n        this.chairsColors();\n      }\n    });\n    this.showingService.getShowingById(this.selectedItem).subscribe(data => {\n      let idSch = data.scheduleID;\n      if (idSch != undefined) {\n        this.scheduleService.getScheduleById(idSch).subscribe(d => {\n          if (d.discount != undefined) {\n            this.discount = d.discount;\n          }\n        });\n      }\n    });\n  }\n  onClick(event) {\n    console.log(\"El botón presionado es: \" + event.target.id);\n    let idB = this.getIdsRowColumn(event.target.id);\n    const button = document.getElementById(event.target.id);\n    if (button) {\n      if (button.style.backgroundColor == 'green') {\n        button.style.backgroundColor = 'lightgrey';\n        this.deleteSeat(parseInt(idB[0]), idB[1]);\n        this.chairService.getChairByRowColumn(parseInt(idB[0]), idB[1]).subscribe(data => {\n          this.chairService.getPriceByLever(data.levelID).subscribe(p => {\n            let price = p;\n            if (this.discount > 0) {\n              price = p - p * this.discount / 100;\n            }\n            console.log(\"precio antes de descuento: \" + p);\n            console.log(\"descuento: \" + this.discount);\n            this.saleValue -= price;\n          });\n        });\n      } else {\n        button.style.backgroundColor = 'green';\n        let row = parseInt(idB[0]);\n        console.log(\"column tranform: \" + idB[1]);\n        this.chairService.getChairByRowColumn(row, idB[1]).subscribe(data => {\n          console.log(data.toString());\n          this.chairsSellList.push(data);\n          this.chairService.getPriceByLever(data.levelID).subscribe(p => {\n            let price = p;\n            if (this.discount > 0) {\n              price = p - p * this.discount / 100;\n            }\n            this.saleValue += price;\n          });\n        });\n      }\n    }\n  }\n  sell() {\n    if (this.chairsSellList != null) {\n      if (this.chairsSellList.length > 0) {\n        let tickets = [];\n        this.chairsSellList.forEach(item => {\n          console.log(\"item: \" + item.chairID);\n          if (item.chairID !== undefined) {\n            let t = new TicketModel();\n            t.idChair = item.chairID;\n            t.idShowing = this.selectedItem;\n            tickets.push(t);\n          }\n        });\n        let sale = new SaleModel();\n        sale.date = new Date();\n        sale.saleValue = this.saleValue;\n        sale.showingID = this.selectedItem;\n        sale.tickets = tickets;\n        this.saleService.postSale(sale).subscribe(data => {\n          console.log(\"data sale: \" + data);\n        });\n        this.router.navigateByUrl('/', {\n          skipLocationChange: true\n        }).then(() => {\n          this.router.navigate(['create-sale']).then(() => {\n            console.log(`After navigation I am on:${this.router.url}`);\n          });\n        });\n      } else {\n        window.alert(\"You should select at least 1 seat\");\n      }\n    } else {\n      window.alert(\"You should select at least 1 seat\");\n    }\n  }\n  getIdsRowColumn(id) {\n    let splitIds = [];\n    if (id.length == 3) {\n      let num = id.charAt(0) + id.charAt(1);\n      let row = id.charAt(2);\n      splitIds.push(num);\n      splitIds.push(row);\n    } else {\n      let num = id.charAt(0);\n      let row = id.charAt(1);\n      splitIds.push(num);\n      splitIds.push(row);\n    }\n    return splitIds;\n  }\n  deleteSeat(number, row) {\n    let ix = this.chairsSellList.indexOf(this.chairsSellList.filter(c => c.number == number && c.row == row)[0]);\n    console.log(\"indice a eliminar: \" + ix);\n    this.chairsSellList.splice(ix, 1);\n  }\n  chairsColors() {\n    this.disableChairs.forEach(item => {\n      let idBtn = item.number + \"\" + item.row;\n      let button = document.getElementById(idBtn);\n      if (button) {\n        console.log(\"button is true idBtn: \" + idBtn);\n        button.style.backgroundColor = 'red';\n        button.disabled = true;\n      }\n    });\n  }\n  clearColors() {\n    if (this.disableChairs != null) {\n      this.disableChairs.forEach(item => {\n        let idBtn = item.number + \"\" + item.row;\n        let button = document.getElementById(idBtn);\n        if (button) {\n          console.log(\"button is true idBtn: \" + idBtn);\n          button.style.backgroundColor = 'lightgrey';\n          button.disabled = false;\n        }\n      });\n    }\n  }\n}\nSaleComponent.ɵfac = function SaleComponent_Factory(t) {\n  return new (t || SaleComponent)(i0.ɵɵdirectiveInject(i1.ShowingService), i0.ɵɵdirectiveInject(i2.ChairService), i0.ɵɵdirectiveInject(i3.SaleService), i0.ɵɵdirectiveInject(i4.ScheduleService), i0.ɵɵdirectiveInject(i5.Router));\n};\nSaleComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: SaleComponent,\n  selectors: [[\"app-sale\"]],\n  decls: 25,\n  vars: 5,\n  consts: [[1, \"box\"], [1, \"shows\"], [3, \"ngModel\", \"change\", \"ngModelChange\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"tableShows\"], [4, \"ngFor\", \"ngForOf\"], [\"colspan\", \"10\", 1, \"pantalla\"], [\"id\", \"saleValue\"], [\"id\", \"discount\"], [\"id\", \"sellbtn\", \"disabled\", \"\", 3, \"click\"], [3, \"value\"], [1, \"seatbtn\", 3, \"id\", \"click\"]],\n  template: function SaleComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"label\");\n      i0.ɵɵtext(3, \"Showing Selection\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(4, \"br\");\n      i0.ɵɵelementStart(5, \"select\", 2);\n      i0.ɵɵlistener(\"change\", function SaleComponent_Template_select_change_5_listener() {\n        return ctx.onChange();\n      })(\"ngModelChange\", function SaleComponent_Template_select_ngModelChange_5_listener($event) {\n        return ctx.selectedItem = $event;\n      });\n      i0.ɵɵtemplate(6, SaleComponent_option_6_Template, 2, 2, \"option\", 3);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(7, \"div\")(8, \"table\", 4)(9, \"tbody\");\n      i0.ɵɵtemplate(10, SaleComponent_tr_10_Template, 2, 1, \"tr\", 5);\n      i0.ɵɵelementStart(11, \"tr\")(12, \"td\", 6);\n      i0.ɵɵtext(13, \"PANTALLA\");\n      i0.ɵɵelementEnd()()()()();\n      i0.ɵɵelementStart(14, \"div\")(15, \"h3\");\n      i0.ɵɵtext(16, \"Sale Value\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(17, \"p\", 7);\n      i0.ɵɵtext(18);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(19, \"h4\");\n      i0.ɵɵtext(20, \"Discount\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(21, \"p\", 8);\n      i0.ɵɵtext(22);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(23, \"button\", 9);\n      i0.ɵɵlistener(\"click\", function SaleComponent_Template_button_click_23_listener() {\n        return ctx.sell();\n      });\n      i0.ɵɵtext(24, \"SELL\");\n      i0.ɵɵelementEnd()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngModel\", ctx.selectedItem);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngForOf\", ctx.showings);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngForOf\", ctx.columns);\n      i0.ɵɵadvance(8);\n      i0.ɵɵtextInterpolate1(\"$ \", ctx.saleValue, \"\");\n      i0.ɵɵadvance(4);\n      i0.ɵɵtextInterpolate1(\"\", ctx.discount, \"%\");\n    }\n  },\n  dependencies: [i6.NgForOf, i7.NgSelectOption, i7.ɵNgSelectMultipleOption, i7.SelectControlValueAccessor, i7.NgControlStatus, i7.NgModel],\n  styles: [\"button[_ngcontent-%COMP%]:hover:not(:disabled) {\\r\\n    background: darkorange;\\r\\n    transform: scale(1.2);\\r\\n}\\r\\n\\r\\n.seatbtn[_ngcontent-%COMP%]{\\r\\n    background-color: lightgray;\\r\\n}\\r\\n\\r\\n.box[_ngcontent-%COMP%] {\\r\\n    display: flex;\\r\\n    flex-wrap: wrap;\\r\\n}\\r\\n\\r\\n.shows[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{\\r\\n    margin-left: 1.5em;\\r\\n\\r\\n    \\r\\n}\\r\\n.pantalla[_ngcontent-%COMP%]{\\r\\n    text-align: center;\\r\\n    font-weight: bold;\\r\\n}\\r\\n\\r\\n#sellbtn[_ngcontent-%COMP%]{\\r\\n    border-radius: 10px;\\r\\n    background-color: #302b96;\\r\\n    color: aliceblue;\\r\\n    width: 100px;\\r\\n}\\r\\n\\r\\n#sellbtn[_ngcontent-%COMP%]:hover:not(:disabled){\\r\\n    background: darkorange;\\r\\n    transform: scale(1.2);\\r\\n    font-weight: bold;\\r\\n}\\r\\n\\r\\n#sellbtn[_ngcontent-%COMP%]:disabled {\\r\\n    opacity: 0.5;\\r\\n    cursor: not-allowed;\\r\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvc2FsZS9zYWxlLmNvbXBvbmVudC5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7SUFDSSxzQkFBc0I7SUFDdEIscUJBQXFCO0FBQ3pCOztBQUVBO0lBQ0ksMkJBQTJCO0FBQy9COztBQUVBO0lBQ0ksYUFBYTtJQUNiLGVBQWU7QUFDbkI7O0FBRUE7SUFDSSxrQkFBa0I7OztBQUd0QjtBQUNBO0lBQ0ksa0JBQWtCO0lBQ2xCLGlCQUFpQjtBQUNyQjs7QUFFQTtJQUNJLG1CQUFtQjtJQUNuQix5QkFBeUI7SUFDekIsZ0JBQWdCO0lBQ2hCLFlBQVk7QUFDaEI7O0FBRUE7SUFDSSxzQkFBc0I7SUFDdEIscUJBQXFCO0lBQ3JCLGlCQUFpQjtBQUNyQjs7QUFFQTtJQUNJLFlBQVk7SUFDWixtQkFBbUI7QUFDdkIiLCJzb3VyY2VzQ29udGVudCI6WyJidXR0b246aG92ZXI6bm90KDpkaXNhYmxlZCkge1xyXG4gICAgYmFja2dyb3VuZDogZGFya29yYW5nZTtcclxuICAgIHRyYW5zZm9ybTogc2NhbGUoMS4yKTtcclxufVxyXG5cclxuLnNlYXRidG57XHJcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiBsaWdodGdyYXk7XHJcbn1cclxuXHJcbi5ib3gge1xyXG4gICAgZGlzcGxheTogZmxleDtcclxuICAgIGZsZXgtd3JhcDogd3JhcDtcclxufVxyXG5cclxuLnNob3dzIHNlbGVjdHtcclxuICAgIG1hcmdpbi1sZWZ0OiAxLjVlbTtcclxuXHJcbiAgICBcclxufVxyXG4ucGFudGFsbGF7XHJcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XHJcbiAgICBmb250LXdlaWdodDogYm9sZDtcclxufVxyXG5cclxuI3NlbGxidG57XHJcbiAgICBib3JkZXItcmFkaXVzOiAxMHB4O1xyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogIzMwMmI5NjtcclxuICAgIGNvbG9yOiBhbGljZWJsdWU7XHJcbiAgICB3aWR0aDogMTAwcHg7XHJcbn1cclxuXHJcbiNzZWxsYnRuOmhvdmVyOm5vdCg6ZGlzYWJsZWQpe1xyXG4gICAgYmFja2dyb3VuZDogZGFya29yYW5nZTtcclxuICAgIHRyYW5zZm9ybTogc2NhbGUoMS4yKTtcclxuICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xyXG59XHJcblxyXG4jc2VsbGJ0bjpkaXNhYmxlZCB7XHJcbiAgICBvcGFjaXR5OiAwLjU7XHJcbiAgICBjdXJzb3I6IG5vdC1hbGxvd2VkO1xyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n});","map":{"version":3,"mappings":"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","names":["TicketModel","SaleModel","i0","SaleComponent","constructor","showingService","chairService","saleService","scheduleService","router","ngOnInit","getShowings","subscribe","data","showings","getRows","columns","getNumbers","rows","e","console","log","onChange","selectedItem","saleValue","button","document","getElementById","disabled","clearColors","getOccupiedChairsByShow","disableChairs","chairsColors","getShowingById","idSch","scheduleID","undefined","getScheduleById","d","discount","onClick","event","target","id","idB","getIdsRowColumn","style","backgroundColor","deleteSeat","parseInt","getChairByRowColumn","getPriceByLever","levelID","p","price","row","toString","chairsSellList","push","sell","length","tickets","forEach","item","chairID","t","idChair","idShowing","sale","date","Date","showingID","postSale","navigateByUrl","skipLocationChange","then","navigate","url","window","alert","splitIds","num","charAt","number","ix","indexOf","filter","c","splice","idBtn","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["D:\\Angular Test Projects\\frontend-cinema\\src\\app\\sale\\sale.component.ts","D:\\Angular Test Projects\\frontend-cinema\\src\\app\\sale\\sale.component.html"],"sourcesContent":["import { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\nimport { ShowingModel } from '../models/showing.model';\nimport { ShowingService } from '../services/showing.service';\nimport { ChairService } from '../services/chair.service';\nimport { ChairModel } from '../models/chair.model';\nimport { SaleService } from '../services/sale.service';\nimport { TicketModel } from '../models/ticket.model';\nimport { SaleModel } from '../models/sale.model';\nimport { Router } from '@angular/router';\nimport { ScheduleService } from '../services/schedule.service';\n\n@Component({\n  selector: 'app-sale',\n  templateUrl: './sale.component.html',\n  styleUrls: ['./sale.component.css']\n})\nexport class SaleComponent implements OnInit {\n\n  showings!: ShowingModel[];\n  selectedItem!: Number;\n  rows:number[]=[];\n  columns: String[] = [];\n  saleValue: number = 0;\n  chairsSellList:ChairModel[] = [];\n  disableChairs:ChairModel[] = [];\n  allChairsList:ChairModel[] = [];\n  discount:number=0;\n \n\n  constructor(private showingService : ShowingService, private chairService: ChairService,\n    private saleService: SaleService, private scheduleService: ScheduleService, private router: Router){}\n\n  ngOnInit(): void {\n    \n    //this.FullColumns();\n\n    try{\n\n      this.showingService.getShowings().subscribe(data=>{\n        \n        this.showings = data; \n\n   \n      });\n\n      this.chairService.getRows().subscribe(data=>{\n        this.columns= data;\n      });\n\n      this.chairService.getNumbers().subscribe(data=>{\n        this.rows= data;\n      });\n\n      \n\n    }catch(e){\n      console.log(\"error: \"+ e);\n    }\n    \n  }\n\n  public onChange(){\n\n    console.log(\"ID Selected: \"+this.selectedItem);\n\n    this.saleValue=0;\n\n    let button = document.getElementById(\"sellbtn\") as HTMLButtonElement;\n\n    if(button){\n      button.disabled=false;\n    }\n\n    this.clearColors();\n\n    this.chairService.getOccupiedChairsByShow(this.selectedItem).subscribe(data=>{\n      this.disableChairs=data;\n      if(this.disableChairs!=null){\n        this.chairsColors();\n      }\n    });\n\n    this.showingService.getShowingById(this.selectedItem).subscribe(data =>{\n      let idSch = data.scheduleID;\n      if(idSch!= undefined){\n        this.scheduleService.getScheduleById(idSch).subscribe(d =>{\n\n          if(d.discount!= undefined){\n            this.discount = d.discount;\n          }\n          \n        });\n      }\n      \n    });\n\n  }\n\n\n  onClick(event: any) {\n    console.log(\"El botón presionado es: \" + event.target.id);\n    \n    let idB = this.getIdsRowColumn(event.target.id);\n\n    const button = document.getElementById(event.target.id);\n    if (button) {\n      if(button.style.backgroundColor == 'green'){\n        button.style.backgroundColor = 'lightgrey';\n\n        this.deleteSeat(parseInt(idB[0]),idB[1]);\n        this.chairService.getChairByRowColumn(parseInt(idB[0]),idB[1]).subscribe(data=>{\n          \n          this.chairService.getPriceByLever(data.levelID).subscribe(p=>{\n            let price = p;\n            if(this.discount>0){\n              price = p-((p*this.discount)/100);\n            }\n            console.log(\"precio antes de descuento: \"+p);\n            console.log(\"descuento: \"+this.discount);\n            this.saleValue-=price;\n          });\n        });\n        \n       \n      }else{\n        button.style.backgroundColor = 'green';\n        \n\n          let row = parseInt(idB[0]);\n          console.log(\"column tranform: \"+ idB[1]);\n          this.chairService.getChairByRowColumn(row,idB[1]).subscribe(data=>{\n            console.log(data.toString());\n            this.chairsSellList.push(data);\n            \n            this.chairService.getPriceByLever(data.levelID).subscribe(p=>{\n              let price = p;\n              if(this.discount>0){\n                price = p-((p*this.discount)/100);\n              }\n              this.saleValue+=price;\n            });\n          });\n      }\n      \n    }\n\n  }\n\n  public sell(){\n\n    if(this.chairsSellList!=null){\n      if(this.chairsSellList.length>0){\n        let tickets:TicketModel[] = [];\n    \n\n        this.chairsSellList.forEach((item)=>{\n          console.log(\"item: \"+item.chairID);\n          if(item.chairID !== undefined){\n            let t:TicketModel = new TicketModel();\n            t.idChair=item.chairID;\n            t.idShowing=this.selectedItem;\n            tickets.push(t);\n          }      \n        });\n\n        let sale: SaleModel = new SaleModel();\n\n        sale.date = new Date();\n        sale.saleValue = this.saleValue;\n        sale.showingID = this.selectedItem;\n        sale.tickets = tickets;\n\n        this.saleService.postSale(sale).subscribe(data=>{\n          console.log(\"data sale: \"+ data);\n        });\n\n        this.router.navigateByUrl('/',{skipLocationChange:true}).then(()=>{\n          this.router.navigate(['create-sale']).then(()=>{\n            console.log(`After navigation I am on:${this.router.url}`)\n          })\n        });\n      }else{\n        window.alert(\"You should select at least 1 seat\");\n      }\n    }else{\n      window.alert(\"You should select at least 1 seat\");\n    }\n\n\n  }\n\n  private getIdsRowColumn(id:String): string[]{\n    let splitIds: string[] = [];\n    \n    if(id.length==3){\n      let num = id.charAt(0)+id.charAt(1);\n      let row = id.charAt(2);\n      splitIds.push(num);\n      splitIds.push(row);\n    }else{\n      let num = id.charAt(0);\n      let row = id.charAt(1);\n      splitIds.push(num);\n      splitIds.push(row);\n    }\n\n    return splitIds\n\n  }\n\n  private deleteSeat(number:Number, row:string){\n\n    let ix = this.chairsSellList.indexOf(\n      this.chairsSellList.filter(c => c.number==number && c.row== row)[0]);\n\n    console.log(\"indice a eliminar: \"+ix);\n\n    this.chairsSellList.splice(ix, 1);\n\n  }\n\n  private chairsColors(){\n\n    this.disableChairs.forEach((item) => {\n      let idBtn = item.number+\"\"+item.row;\n      let button = document.getElementById(idBtn) as HTMLButtonElement;\n      if (button) {\n        console.log(\"button is true idBtn: \"+idBtn);\n        button.style.backgroundColor = 'red';\n        button.disabled = true;\n      }\n    });\n      \n  }\n\n  private clearColors(){\n\n    if(this.disableChairs!=null){\n      this.disableChairs.forEach((item) => {\n        let idBtn = item.number+\"\"+item.row;\n        let button = document.getElementById(idBtn) as HTMLButtonElement;\n        if (button) {\n          console.log(\"button is true idBtn: \"+idBtn);\n          button.style.backgroundColor = 'lightgrey';\n          button.disabled = false;\n        }\n      });\n    }\n\n  }\n\n\n}\n","<div class=\"box\">\n    <div class=\"shows\">\n        <label>Showing Selection</label>\n        <br>\n        <select (change)=\"onChange()\"  [(ngModel)]=\"selectedItem\">\n            <option *ngFor=\"let item of showings\" [value]=\"item.showID\">{{ item.movieName }}</option>\n        </select>\n    </div>\n    <div>\n        <table class=\"tableShows\">\n            <tbody>\n                <tr *ngFor=\"let c of columns\">\n                    <td *ngFor=\"let r of rows\">\n                        <button class=\"seatbtn\" (click)=\"onClick($event)\" id={{r}}{{c}}>{{r}}{{c}}</button>\n                    </td>\n                </tr>\n                <tr>\n                    <td class=\"pantalla\" colspan=10>PANTALLA</td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n    <div>\n        <h3>Sale Value</h3>\n        <p id=\"saleValue\" >$ {{saleValue}}</p>\n        <h4>Discount</h4>\n        <p id=\"discount\" >{{discount}}%</p>\n        <button id=\"sellbtn\" (click)=\"sell()\" disabled>SELL</button>\n    </div>\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}